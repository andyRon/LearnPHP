php之道
----

https://learnku.com/docs/php-the-right-way/PHP8.0

[php之道( PHP: The Right Way)]()是一个易于阅读的 PHP 流行编码标准快速参考手册。



## 前言

PHP 5.4 之后内置了 Web 服务器，从命令行终端进入项目的 Web 根目录，执行下面的命令:

```sh
> php -S localhost:8000
```



```sh
brew install php@8.0
```





[phpbrew](https://github.com/phpbrew/phpbrew) 是一个用于安装和管理多个 PHP 版本的工具。 如果两个不同的应用程序 / 项目需要不同版本的 PHP，而且你没有使用虚拟机，这会非常有用。





## 语言亮点

### 编程范式

PHP 是一个灵活的动态语言，支持多种编程技巧。这几年一直不断的发展，重要的里程碑包含 PHP 5.0 (2004) 增加了完善的面向对象模型，PHP 5.3 (2009) 增加了匿名函数与命名空间以及 PHP 5.4 (2012) 增加的 traits。

### 面向对象编程

PHP 拥有完整的面向对象编程的特性，包括类，抽象类，接口，继承，构造函数，克隆和异常等。

### 函数式编程

PHP 支持函数是「第一等公民」，即函数可以被赋值给一个变量，包括用户自定义的或者是内置函数，然后动态调用它。函数可以作为参数传递给其他函数（称为`_高阶函数_`），也可以作为函数返回值返回。

PHP 支持递归，也就是函数自己调用自己，但多数 PHP 代码使用迭代。

自从 PHP 5.3 (2009) 之后开始引入对闭包以及匿名函数的支持。

PHP 5.4 增加了将闭包绑定到对象作用域中的特性，并改善其可调用性，如此即可在大部分情况下使用匿名函数取代一般的函数。



### 元编程

PHP 通过反射 API 和魔术方法等机制，支持多种形式的元编程。有许多魔术方法，如 `__get()`， `__set()`， `__clone()`， `__toString()`， `__invoke()` 等，可供开发者改变类的行为。 Ruby 开发者常说 PHP 缺少 method_missing 方法，实际上通过 `__call()` 和 `__callStatic()` 就可以完成相同的功能。



### 命名空间





### PHP标准库

PHP标准库 (SPL) 与 PHP 打包在一起，并提供了类和接口的集合。它主要由常见的数据结构类(栈，队列，堆等) 和迭代器组成，可以遍历这些数据结构或您自己的实现spl接口的类。



### 命令行界面



```shell
php -i
php -a

```



### Xdebug  🔖

Xdebug 是一个 php 的调试器，它可以被用来在很多 IDE (集成开发环境) 中做断点调试以及堆栈检查。它还可以像 PHPUnit 和 KCacheGrind 一样，做代码覆盖检查或者程序性能跟踪。



## 依赖管理

目前有两个主要的 PHP 依赖管理工具 - [Composer](https://phptherightway.com/#composer_and_packagist) 和 [PEAR](https://phptherightway.com/#pear) 。

### Composer 🔖

#### 更新依赖项

Composer 创建了一个名为 composer.lock 的文件，存放了当你首次运行 composer install 时每个包的准确版本。如果你将项目共享给他人，要确保 composer.lock 也一起共享出去，这样别人在执行 composer install 的时候也会安装和你一样的包版本。想要更新依赖项，执行 composer update 命令就可以了。在项目部署时不要使用 composer update，只执行 composer install 就可以了，不然你会在生产环境中安装了和开发环境不同版本的依赖包。

这在你需要灵活定义版本时非常有用。例如 ~1.8 意味着任何高于 1.8.0 的版本，但要小于 2.0.x-dev。你同样可以使用 * 通配符，例如 1.8.*。这样配置后，Composer 的 composer update 命令会将所有的依赖项升级到符合你设定的最新版本。



## 开发实践

### 日期和时间



### 设计模式



### 使用 UTF-8 编码

目前 PHP 仍未在底层实现对 Unicode 的支持。虽然有很多途径可以确保 UTF-8 字符串能够被正确地处理，但这并不是件很简单的事情，通常需要对 Web 应用进行全方面的检查，从 HTML 到 SQL 再到 PHP。



#### PHP 层面的 UTF-8



#### 数据库级别的 UTF-8

要确保您的字符串以 UTF-8 格式从 PHP 传输到 MySQL，请确保您的数据库和表都设置为 “utf8mb4” 字符集和排序规则，并且您在 PDO 连接字符串中使用 “utf8mb4” 字符集。 



#### 浏览器级别的 UTF-8



### 国际化（i18n）和本地化（l10n）

- ==国际化== 是指当你组织代码时，无需重构就可以适配不同的语言地区。这件事只需要做一次 —— 最好是在项目开始时，否则你可能需要大规模重构源码！
- ==本地化== 通常是基于 i18n 已经完成的工作，通过翻译内容来调整接口。通常是在需要支持新语言或区域时，并且需要添加新接口时来做这件事，因为所有的接口需要在全部支持的语言中保证可用。
- ==多元化== 定义了在不同语言之间互相操作字符串所需的规则和计数方法。例如，英语中你只有一个物品，它是单数的，其余的都是复数。复数在这类语言中会在单词后面加一个 S，有的时候也会改变单词的一部分。在其他语言中，像是俄罗斯与或塞尔威亚语，除了单数之外还有两种复数形式 —— 你甚至还能找到有四五种复数形式的语言，例如斯洛文尼亚语、爱尔兰语和阿拉伯语。

#### 常见的实现方式

数组

gettext



#### 其他工具



## 依赖注入



## 数据库

在 PHP 5.1.0 之前，我们推荐的方式是使用例如 mysqli，pgsql，mssql 等原生驱动。

在只使用 一个 数据库的情况下，原生驱动是不错的方式，但如果你同时使用了 MySQL 和一点点 MSSQL，或者你需要使用 Oracle 的数据库，那你就不能只使用一个数据库驱动了。你需要为每个数据库学习各自不同的 API — 这样做显然不科学。

### PDO



### 数据库抽象层

许多框架都提供了自己的数据库抽象层，其中一些是设计在 PDO 上层的。这些抽象层通常将你的请求在 PHP 方法中包装起来，通过模拟的方式来使你的数据库拥有一些之前不支持的功能。这种抽象是真正的数据库抽象，而不单单只是 PDO 提供的数据库连接抽象。这类抽象的确会增加一定程度的性能开销，但如果你正在设计的应用程序需要同时使用 MySQL、PostgreSQL 和 SQLite 时，一点点的额外性能开销对于代码整洁度的提高来说还是很值得的。



## 使用模板

### 普通 PHP 模板

普通 PHP 模板只是使用原生 PHP 代码的模板。

 [Plates](http://platesphp.com/) 或 [Aura.View](https://github.com/auraphp/Aura.View)



### 编译模板

如 [Twig](https://twig.symfony.com/)，[Brainy](https://github.com/box/brainy)，或 [Smarty](https://www.smarty.net/)

从自动转义到继承以及简化的控制结构，编译模板设计为更易于编写、更清晰易读和使用更安全。编译模板甚至可以跨不同语言共享，Mustache 就是一个很好的例子。由于这些模板必须编译，因此会对性能造成轻微的影响，但是在适当地使用缓存后影响就非常小了。



## 错误与异常





## 安全

关于 PHP 安全性的最佳资源是由 [Paragon Initiative](https://paragonie.com/) 公司编写的 [2018 年 PHP 系统安全构架指南](https://paragonie.com/blog/2017/12/2018-guide-building-secure-php-software) 。



## 测试





## 服务器与部署

### 平台即服务 (PaaS)



### 虚拟或专用服务器

#### nginx 和 PHP-FPM

PHP, 通过 PHP 内置的 FastCGI 进程管理器 (FPM), 可以很好的与轻量级的高性能 web 服务器软件 nginx 一起工作。 Nginx 比 Apache 占用更少内存并且处理更多的并发请求，这对那些没有太多内存的虚拟服务器特别重要。



#### Apache 和 PHP





### 共享主机



### 构建和部署您的应用程序



## 虚拟化

如果你的应用程序在开发阶段与生产阶段的运行环境不一致，可能会在上线时遇到各种奇怪的 BUG 。在团队开发过程中，要让不同开发环境的所有成员都统一保持最新版本的软件和类库，也是一件很让人头痛的事情。

### Vagrant



### Docker 🔖



## 缓存

### 操作码缓存

[Zend OPcache](https://secure.php.net/book.opcache).



### 对象缓存

最常用的内存对象缓存系统是 APCu 和 Memcached 。



## 代码注释

PHPDoc    [PHPDoc manual](https://docs.phpdoc.org/latest/index.html) 



## 资源



## 社区
